#!/usr/bin/python

import pytest
import sys
import requests

headers = {'X-API-KEY':'test_token'}
invalid_headers = {'X-API-KEY':'wrong_token'}

#########################################################
#                     Cloud Tests                       #
#########################################################

def test_api_cloud_get_search_book(): 
    req_url = "http://book-tracker-orch1-brave-elephant.mybluemix.net/api/search/Phillip%20Laplante"
    r = requests.get(url = req_url, headers = headers) 
    assert r.json() == { "body": { "books": [ { "author": [ "Phillip Laplante" ], "isbn": "9780830639526", "publication_date": 1992, "publisher": "Windcrest", "title": "Easy PC maintenance and repair" }, { "author": [ "Phillip Laplante" ], "isbn": "0780347315", "publication_date": 1999, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Electrical Engineering Dictionary" }, { "author": [ "Phillip Laplante" ], "isbn": "9780849326974", "publication_date": 2000, "publisher": "Crc Pr I Llc", "title": "Dictionary of Computer Science, Engineering, and Technology" }, { "author": [ "Phillip Laplante" ], "isbn": "0780323394", "publication_date": 1997, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Design and Application of Real-Time Systems" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780830639526", "publication_date": 1992, "publisher": "Windcrest/McGraw-Hill", "title": "Easy PC maintenance and repair" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0849313767", "publication_date": 2003, "publisher": "Taylor and Francis", "title": "Software engineering for image processing systems" }, { "author": [ "Phillip A. Laplante" ], "isbn": "1420031244", "publication_date": 2005, "publisher": "Taylor and Francis", "title": "AntiPatterns" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0849372283", "publication_date": 2007, "publisher": "Taylor and Francis", "title": "What every engineer should know about software engineering" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780780348158", "publication_date": 1999, "publisher": "Institute of Electrical & Electronics Enginee", "title": "A Practical Approach to Real-Time Systems" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780780348035", "publication_date": 1999, "publisher": "Institute of Electtrical and Electronics Engineers", "title": "Keys to Successful Software Development" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0780353412", "publication_date": 2001, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Real-Time Systems" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0780368169", "publication_date": 1996, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Design and Application of Real-Time Systems" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780780348028", "publication_date": 1999, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Successful Software Project Management" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0830644342", "publication_date": 1993, "publisher": "Windcrest/McGraw Hill", "title": "Fractal mania" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780780348387", "publication_date": 2001, "publisher": "Inst Elect & Electronic Engineers", "title": "Software Engineering Ssc" }, { "author": [ "Phillip A. Laplante" ], "isbn": "1590338898", "publication_date": 2003, "publisher": "Nova Science Publishers", "title": "Biocomputing" }, { "author": [ "Phillip Laplante", "Thomas Costello" ], "isbn": "0131855891", "publication_date": 2005, "publisher": "Prentice Hall PTR", "title": "CIO Wisdom II" }, { "author": [ "Phillip Laplante", "Thomas Costello" ], "isbn": "0131855891", "publication_date": 2005, "publisher": "Prentice Hall PTR", "title": "CIO Wisdom II" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9781439820858", "publication_date": 2011, "publisher": "CRC Press", "title": "Technical Writing A Practical Guide For Engineers And Scientists" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780849326912", "publication_date": 2001, "publisher": "CRC Press", "title": "Dictionary of computer science, engineering, and technology" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0314012621", "publication_date": 1993, "publisher": "West Pub. Co.", "title": "Using UNIX" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0849330866", "publication_date": 2005, "publisher": "Taylor & Francis Books Ltd/CRC", "title": "Comprehensive dictionary of electrical engineering" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0849331285", "publication_date": 1999, "publisher": "CRC Press", "title": "Comprehensive dictionary of electrical engineering" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0471228559", "publication_date": 2004, "publisher": "Wiley", "title": "Real-time system design and analysis" }, { "author": [ "Phillip A. Laplante", "Philip A. Laplante" ], "isbn": "9780780311527", "publication_date": 1993, "publisher": "IEEE Computer Society Press", "title": "Real-Time Systems Design and Analysis" }, { "author": [ "Philip A. Laplante", "Phillip A. Laplante" ], "isbn": "9781420059779", "publication_date": 2010, "publisher": "AUERBACH", "title": "Encyclopedia of Software Engineering, Three Volume Set" }, { "author": [ "Nasser Kehtarnavaz", "Phillip A. Laplante" ], "isbn": "9780819461032", "publication_date": 2006, "publisher": "IS&T", "title": "Real-time image processing 2006" }, { "author": [ "Nasser Kehtarnavaz", "Phillip A. Laplante" ], "isbn": "0819456446", "publication_date": 2005, "publisher": "IS&T", "title": "Real-time imaging IX" }, { "author": [ "Nasser Kehtarnavaz", "Phillip A. Laplante" ], "isbn": "9780819448125", "publication_date": 2003, "publisher": "SPIE", "title": "Real-time imaging VII" }, { "author": [ "Phillip A. Laplante", "Colin J. Neill", "Philip A. Laplante" ], "isbn": "9781420064674", "publication_date": 2009, "publisher": "Auerbach Publications", "title": "Requirements engineering for software and systems" }, { "author": [ "Phillip A. Laplante", "Alexander D. Stoyenko" ], "isbn": "0780310683", "publication_date": 1996, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Real-time imaging" }, { "author": [ "William F. Gilreath", "Phillip A. Laplante" ], "isbn": "1402074166", "publication_date": 2003, "publisher": "Springer", "title": "Computer architecture" }, { "author": [ "Philip A. Laplante" ], "isbn": "9781420037807", "publication_date": 2005, "publisher": "Taylor and Francis", "title": "Comprehensive Dictionary of Electrical Engineering" }, { "author": [ "Philip A. Laplante" ], "isbn": "9780780348240", "publication_date": 2000, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Real-Time Signal and Image Processing" }, { "author": [ "Phillip A. Laplante", "Wolfgang A. Halang", "P. Laplante", "W.A. Halang" ], "isbn": "9780080425900", "publication_date": 1996, "publisher": "Pergamon", "title": "Real time programming 1995" }, { "author": [ "C. B. Johnson", "Divyendu Sinha", "Phillip A. Laplante" ], "isbn": "0819445630", "publication_date": 2003, "publisher": "SPIE", "title": "Low-light-level and real-time imaging systems, components, and applications" }, { "author": [ "Phillip A. Laplante", "Alexander D. Stoyenko", "Divyendu Sinha" ], "isbn": "0819420352", "publication_date": 1996, "publisher": "SPIE", "title": "Real-time imaging" }, { "author": [ "William F. Gilreath" ], "isbn": "146134980X", "publication_date": 2003, "publisher": "Springer US", "title": "Computer Architecture: A Minimalist Perspective" }, { "author": [ "Edward R. Dougherty" ], "isbn": "9780819417893", "publication_date": 1995, "publisher": "SPIE Optical Engineering Press", "title": "Introduction to real-time imaging" }, { "author": [ "Bad author - no name" ], "isbn": "9780819448125", "publication_date": 2003, "publisher": "SPIE", "title": "Real-time imaging VII" }, { "author": [ "Colin J. Neill" ], "isbn": "1439861862", "publication_date": 2011, "publisher": "Auerbach Publications", "title": "Antipatterns" } ] }, "headers": { "Content-Type": "application/json" }, "statusCode": 200 }

def test_api_cloud_get_favorites_without_token():
    req_url = "http://book-tracker-orch1-brave-elephant.mybluemix.net/api/favorites/TEST"
    r = requests.get(url = req_url) 
    assert r.json() == { "message": "Token is missing" }

def test_api_cloud_with_incorrect_token():
    req_url = "http://book-tracker-orch1-brave-elephant.mybluemix.net/api/favorites/TEST"
    r = requests.get(url = req_url, headers=invalid_headers) 
    assert r.json() == { "message": "Incorrect token" }

def test_api_cloud_get_favorites_noresult():
    req_url = "http://book-tracker-orch1-brave-elephant.mybluemix.net/api/favorites/FDSFDSFS"
    r = requests.get(url = req_url, headers=headers) 
    assert r.json() == { "body": [ False ], "headers": { "Content-Type": "application/json" }, "statusCode": 200 }

def test_api_cloud_get_favorites_result():
    req_url = "http://book-tracker-orch1-brave-elephant.mybluemix.net/api/favorites/testforJin%40test.com"
    r = requests.get(url = req_url, headers=headers) 
    assert r.json() == { "body": [ { "AUTHOR": "Test", "CATEGORY": None, "GENRE": None, "ISBN": "Jin123", "PUBLICATION_DATE": "string", "PUBLISHER": "string", "TITLE": "Jinny", "USER_ID": "testforJin@test.com" } ], "headers": { "Content-Type": "application/json" }, "statusCode": 200 }


#########################################################
#                     Local Tests                       #
#########################################################

def test_api_local_get_search_book(): 
    req_url = "http://127.0.0.1:5000/api/search/Phillip%20Laplante"
    r = requests.get(url = req_url, headers = headers) 
    assert r.json() == { "body": { "books": [ { "author": [ "Phillip Laplante" ], "isbn": "9780830639526", "publication_date": 1992, "publisher": "Windcrest", "title": "Easy PC maintenance and repair" }, { "author": [ "Phillip Laplante" ], "isbn": "0780347315", "publication_date": 1999, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Electrical Engineering Dictionary" }, { "author": [ "Phillip Laplante" ], "isbn": "9780849326974", "publication_date": 2000, "publisher": "Crc Pr I Llc", "title": "Dictionary of Computer Science, Engineering, and Technology" }, { "author": [ "Phillip Laplante" ], "isbn": "0780323394", "publication_date": 1997, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Design and Application of Real-Time Systems" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780830639526", "publication_date": 1992, "publisher": "Windcrest/McGraw-Hill", "title": "Easy PC maintenance and repair" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0849313767", "publication_date": 2003, "publisher": "Taylor and Francis", "title": "Software engineering for image processing systems" }, { "author": [ "Phillip A. Laplante" ], "isbn": "1420031244", "publication_date": 2005, "publisher": "Taylor and Francis", "title": "AntiPatterns" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0849372283", "publication_date": 2007, "publisher": "Taylor and Francis", "title": "What every engineer should know about software engineering" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780780348158", "publication_date": 1999, "publisher": "Institute of Electrical & Electronics Enginee", "title": "A Practical Approach to Real-Time Systems" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780780348035", "publication_date": 1999, "publisher": "Institute of Electtrical and Electronics Engineers", "title": "Keys to Successful Software Development" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0780353412", "publication_date": 2001, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Real-Time Systems" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0780368169", "publication_date": 1996, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Design and Application of Real-Time Systems" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780780348028", "publication_date": 1999, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Successful Software Project Management" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0830644342", "publication_date": 1993, "publisher": "Windcrest/McGraw Hill", "title": "Fractal mania" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780780348387", "publication_date": 2001, "publisher": "Inst Elect & Electronic Engineers", "title": "Software Engineering Ssc" }, { "author": [ "Phillip A. Laplante" ], "isbn": "1590338898", "publication_date": 2003, "publisher": "Nova Science Publishers", "title": "Biocomputing" }, { "author": [ "Phillip Laplante", "Thomas Costello" ], "isbn": "0131855891", "publication_date": 2005, "publisher": "Prentice Hall PTR", "title": "CIO Wisdom II" }, { "author": [ "Phillip Laplante", "Thomas Costello" ], "isbn": "0131855891", "publication_date": 2005, "publisher": "Prentice Hall PTR", "title": "CIO Wisdom II" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9781439820858", "publication_date": 2011, "publisher": "CRC Press", "title": "Technical Writing A Practical Guide For Engineers And Scientists" }, { "author": [ "Phillip A. Laplante" ], "isbn": "9780849326912", "publication_date": 2001, "publisher": "CRC Press", "title": "Dictionary of computer science, engineering, and technology" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0314012621", "publication_date": 1993, "publisher": "West Pub. Co.", "title": "Using UNIX" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0849330866", "publication_date": 2005, "publisher": "Taylor & Francis Books Ltd/CRC", "title": "Comprehensive dictionary of electrical engineering" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0849331285", "publication_date": 1999, "publisher": "CRC Press", "title": "Comprehensive dictionary of electrical engineering" }, { "author": [ "Phillip A. Laplante" ], "isbn": "0471228559", "publication_date": 2004, "publisher": "Wiley", "title": "Real-time system design and analysis" }, { "author": [ "Phillip A. Laplante", "Philip A. Laplante" ], "isbn": "9780780311527", "publication_date": 1993, "publisher": "IEEE Computer Society Press", "title": "Real-Time Systems Design and Analysis" }, { "author": [ "Philip A. Laplante", "Phillip A. Laplante" ], "isbn": "9781420059779", "publication_date": 2010, "publisher": "AUERBACH", "title": "Encyclopedia of Software Engineering, Three Volume Set" }, { "author": [ "Nasser Kehtarnavaz", "Phillip A. Laplante" ], "isbn": "9780819461032", "publication_date": 2006, "publisher": "IS&T", "title": "Real-time image processing 2006" }, { "author": [ "Nasser Kehtarnavaz", "Phillip A. Laplante" ], "isbn": "0819456446", "publication_date": 2005, "publisher": "IS&T", "title": "Real-time imaging IX" }, { "author": [ "Nasser Kehtarnavaz", "Phillip A. Laplante" ], "isbn": "9780819448125", "publication_date": 2003, "publisher": "SPIE", "title": "Real-time imaging VII" }, { "author": [ "Phillip A. Laplante", "Colin J. Neill", "Philip A. Laplante" ], "isbn": "9781420064674", "publication_date": 2009, "publisher": "Auerbach Publications", "title": "Requirements engineering for software and systems" }, { "author": [ "Phillip A. Laplante", "Alexander D. Stoyenko" ], "isbn": "0780310683", "publication_date": 1996, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Real-time imaging" }, { "author": [ "William F. Gilreath", "Phillip A. Laplante" ], "isbn": "1402074166", "publication_date": 2003, "publisher": "Springer", "title": "Computer architecture" }, { "author": [ "Philip A. Laplante" ], "isbn": "9781420037807", "publication_date": 2005, "publisher": "Taylor and Francis", "title": "Comprehensive Dictionary of Electrical Engineering" }, { "author": [ "Philip A. Laplante" ], "isbn": "9780780348240", "publication_date": 2000, "publisher": "Institute of Electrical & Electronics Enginee", "title": "Real-Time Signal and Image Processing" }, { "author": [ "Phillip A. Laplante", "Wolfgang A. Halang", "P. Laplante", "W.A. Halang" ], "isbn": "9780080425900", "publication_date": 1996, "publisher": "Pergamon", "title": "Real time programming 1995" }, { "author": [ "C. B. Johnson", "Divyendu Sinha", "Phillip A. Laplante" ], "isbn": "0819445630", "publication_date": 2003, "publisher": "SPIE", "title": "Low-light-level and real-time imaging systems, components, and applications" }, { "author": [ "Phillip A. Laplante", "Alexander D. Stoyenko", "Divyendu Sinha" ], "isbn": "0819420352", "publication_date": 1996, "publisher": "SPIE", "title": "Real-time imaging" }, { "author": [ "William F. Gilreath" ], "isbn": "146134980X", "publication_date": 2003, "publisher": "Springer US", "title": "Computer Architecture: A Minimalist Perspective" }, { "author": [ "Edward R. Dougherty" ], "isbn": "9780819417893", "publication_date": 1995, "publisher": "SPIE Optical Engineering Press", "title": "Introduction to real-time imaging" }, { "author": [ "Bad author - no name" ], "isbn": "9780819448125", "publication_date": 2003, "publisher": "SPIE", "title": "Real-time imaging VII" }, { "author": [ "Colin J. Neill" ], "isbn": "1439861862", "publication_date": 2011, "publisher": "Auerbach Publications", "title": "Antipatterns" } ] }, "headers": { "Content-Type": "application/json" }, "statusCode": 200 }

def test_api_local_get_favorites_without_token():
    req_url = "http://127.0.0.1:5000/api/favorites/TEST"
    r = requests.get(url = req_url) 
    assert r.json() == { "message": "Token is missing" }

def test_api_local_with_incorrect_token():
    req_url = "http://127.0.0.1:5000/api/favorites/TEST"
    r = requests.get(url = req_url, headers=invalid_headers) 
    assert r.json() == { "message": "Incorrect token" }

def test_api_local_get_favorites_noresult():
    req_url = "http://127.0.0.1:5000/api/favorites/FDSFDSFS"
    r = requests.get(url = req_url, headers=headers) 
    assert r.json() == { "body": [ False ], "headers": { "Content-Type": "application/json" }, "statusCode": 200 }

def test_api_local_get_favorites_result():
    req_url = "http://127.0.0.1:5000/api/favorites/testforJin%40test.com"
    r = requests.get(url = req_url, headers=headers) 
    assert r.json() == { "body": [ { "AUTHOR": "Test", "CATEGORY": None, "GENRE": None, "ISBN": "Jin123", "PUBLICATION_DATE": "string", "PUBLISHER": "string", "TITLE": "Jinny", "USER_ID": "testforJin@test.com" } ], "headers": { "Content-Type": "application/json" }, "statusCode": 200 }

